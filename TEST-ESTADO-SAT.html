<!-- 
TEST MANUAL: Verificar Edici√≥n de Estado SAT
Abre este archivo en tu navegador junto con el reporte
-->

<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test - Estado SAT Editable</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 20px auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .test-section {
        background: white;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .test-title {
        color: #2563eb;
        font-size: 24px;
        margin-bottom: 15px;
      }
      .test-step {
        margin: 15px 0;
        padding: 10px;
        background: #f9fafb;
        border-left: 4px solid #10b981;
      }
      .test-component {
        margin: 20px 0;
        padding: 15px;
        border: 2px solid #e5e7eb;
        border-radius: 4px;
      }
      select {
        width: 100%;
        padding: 8px;
        border: 1px solid #d1d5db;
        border-radius: 4px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s;
      }
      select:focus {
        outline: none;
        ring: 2px;
        ring-color: #3b82f6;
        border-color: #3b82f6;
      }
      .vigente {
        background-color: #d1fae5;
        color: #065f46;
        font-weight: 500;
      }
      .cancelada {
        background-color: #f3e5f5;
        color: #6b21a8;
        font-weight: 500;
      }
      .result {
        margin-top: 10px;
        padding: 10px;
        background: #eff6ff;
        border: 1px solid #bfdbfe;
        border-radius: 4px;
        font-family: monospace;
      }
      .success {
        color: #16a34a;
        font-weight: bold;
      }
      .error {
        color: #dc2626;
        font-weight: bold;
      }
      .checklist {
        list-style: none;
        padding: 0;
      }
      .checklist li {
        padding: 8px;
        margin: 5px 0;
        background: #fef3c7;
        border-left: 4px solid #f59e0b;
      }
      .checklist li.checked {
        background: #d1fae5;
        border-left-color: #10b981;
      }
    </style>
  </head>
  <body>
    <h1>üß™ Test: Componente Estado SAT Editable</h1>

    <div class="test-section">
      <div class="test-title">üìã Pasos de Prueba</div>
      <ul class="checklist">
        <li id="step1">
          ‚úì Abrir navegador en <strong>http://localhost:5175</strong>
        </li>
        <li id="step2">‚úì Abrir DevTools (F12)</li>
        <li id="step3">‚úì Ir a un Trabajo</li>
        <li id="step4">‚úì Abrir un reporte (Auxiliar o Mi Admin)</li>
        <li id="step5">‚¨ú Buscar columna "Estado SAT"</li>
        <li id="step6">‚¨ú Hacer clic en dropdown</li>
        <li id="step7">‚¨ú Cambiar valor</li>
        <li id="step8">‚¨ú Guardar cambios</li>
      </ul>
    </div>

    <div class="test-section">
      <div class="test-title">üéØ Componente de Prueba (Funcional)</div>
      <p>Este es un ejemplo funcional del dropdown que deber√≠as ver:</p>

      <div class="test-component">
        <label><strong>Estado SAT:</strong></label>
        <select id="testSelect" class="vigente">
          <option value="Vigente">Vigente</option>
          <option value="Cancelada">Cancelada</option>
        </select>
        <div class="result" id="testResult">
          Valor actual: <span class="success">Vigente</span>
        </div>
      </div>
    </div>

    <div class="test-section">
      <div class="test-title">üîç Qu√© Buscar en la Consola</div>
      <div class="test-step">
        <strong>1. Durante la carga del reporte:</strong>
        <div class="result">
          üìä Parseando Auxiliar de Ingresos...<br />
          ‚úÖ Columnas detectadas: { UUID: 0, Folio: 1, ... Estado SAT: 8 }<br />
          üîç Row 1: Estado SAT = "Vigente" (raw: "", index: 8)
        </div>
      </div>

      <div class="test-step">
        <strong>2. Si hay problemas:</strong>
        <div class="result error">
          ‚ö†Ô∏è Estado SAT undefined para fila: ABC123
        </div>
      </div>

      <div class="test-step">
        <strong>3. Al cambiar el valor:</strong>
        <div class="result">
          üîÑ Estado SAT cambiado: "Vigente" ‚Üí "Cancelada"
        </div>
      </div>
    </div>

    <div class="test-section">
      <div class="test-title">‚ùå S√≠ntomas de Problemas</div>
      <ul>
        <li>
          <strong>No veo la columna "Estado SAT":</strong> El Excel no tiene esa
          columna
        </li>
        <li>
          <strong>Veo texto plano, no dropdown:</strong> Est√°s usando
          ReporteViewer (tabla vieja)
        </li>
        <li>
          <strong>Dropdown est√° gris (disabled):</strong> Hay alguna condici√≥n
          que lo deshabilita
        </li>
        <li>
          <strong>Cambio no se guarda:</strong> Backend no est√° corriendo o
          error de red
        </li>
      </ul>
    </div>

    <div class="test-section">
      <div class="test-title">üêõ Script de Diagn√≥stico</div>
      <p>Copia y pega esto en la consola del navegador (F12):</p>
      <pre class="result">
// üîç Diagn√≥stico de Estado SAT
(() => {
    console.log('üîç Diagn√≥stico de Estado SAT iniciado...\n');
    
    // Verificar si hay tablas TanStack
    const tables = document.querySelectorAll('table');
    console.log(`üìä Tablas encontradas: ${tables.length}`);
    
    // Buscar selects de Estado SAT
    const selects = document.querySelectorAll('select[title*="Estado SAT"]');
    console.log(`üìã Dropdowns de Estado SAT encontrados: ${selects.length}`);
    
    if (selects.length === 0) {
        console.error('‚ùå NO se encontraron dropdowns de Estado SAT');
        console.log('üí° Posibles causas:');
        console.log('   1. Est√°s usando ReporteViewer (tabla vieja)');
        console.log('   2. La columna no se est√° renderizando');
        console.log('   3. El Excel no tiene la columna Estado SAT');
    } else {
        console.log('‚úÖ Dropdowns encontrados:');
        selects.forEach((sel, i) => {
            console.log(`   ${i + 1}. Valor: ${sel.value}, Disabled: ${sel.disabled}`);
        });
    }
    
    // Verificar tipo de reporte
    const reporteDebug = document.querySelector('.bg-yellow-50');
    if (reporteDebug) {
        console.warn('‚ö†Ô∏è Se detect√≥ ReporteViewer (tabla vieja)');
        console.log(reporteDebug.textContent);
    } else {
        console.log('‚úÖ Usando tabla espec√≠fica (nueva)');
    }
    
    console.log('\nüîç Diagn√≥stico completado');
})();
        </pre
      >
    </div>

    <script>
      // Test funcional del dropdown
      const testSelect = document.getElementById("testSelect");
      const testResult = document.getElementById("testResult");

      testSelect.addEventListener("change", (e) => {
        const newValue = e.target.value;
        const oldClass = testSelect.className;

        // Cambiar clase seg√∫n el valor
        testSelect.className = newValue === "Vigente" ? "vigente" : "cancelada";

        // Actualizar resultado
        const statusClass = newValue === "Vigente" ? "success" : "error";
        testResult.innerHTML = `
                Valor actual: <span class="${statusClass}">${newValue}</span><br>
                <small>Clase CSS: ${testSelect.className}</small><br>
                <small>Cambi√≥ de: ${oldClass}</small>
            `;

        console.log(`üîÑ Test: Estado SAT cambiado a "${newValue}"`);
      });

      // Auto-check de pasos
      setTimeout(() => {
        document.getElementById("step1").classList.add("checked");
      }, 500);
    </script>
  </body>
</html>
